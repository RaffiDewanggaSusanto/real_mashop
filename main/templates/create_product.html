{% extends 'base.html' %}
{% block meta %}
<title>Real Mashop — Create Product</title>
{% endblock meta %}

{% block content %}
<div class="bg-[#000000] w-full min-h-screen pt-16">
  <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-10">

    <!-- Back / Heading -->
    <div class="flex items-center justify-between mb-6">
      <a href="{% url 'main:show_main' %}"
         class="text-white/80 hover:text-[#f0b414] transition-colors">← Back to Product</a>
    </div>

    <!-- 2-column: Form + Side panel -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

      <!-- LEFT: FORM -->
      <div class="lg:col-span-2">
        <div class="bg-white rounded-2xl border border-[#000000] shadow-sm overflow-hidden">
          <div class="px-6 sm:px-8 py-6 border-b border-[#000000]/10">
            <h1 class="text-2xl font-bold text-[#000000]">Create New Product</h1>
            <p class="text-sm text-[#0050a0]">Post your product to the market</p>
          </div>

          <!-- AJAX states -->
          <div id="ajax-loading" class="px-6 sm:px-8 py-6 text-center hidden">
            <svg class="animate-spin h-6 w-6 text-[#0050a0] inline-block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
            </svg>
            <p class="text-[#0050a0] mt-2">Publishing product...</p>
          </div>
          <div id="ajax-error" class="px-6 sm:px-8 py-6 text-center hidden">
            <div class="text-[#f03c50] text-3xl mb-2">⚠️</div>
            <p class="text-[#f03c50]">Failed to publish product. Please try again.</p>
          </div>
          <div id="ajax-success" class="px-6 sm:px-8 py-6 text-center hidden">
            <div class="text-[#0050a0] text-3xl mb-2">✅</div>
            <p class="text-[#0050a0]">Product published successfully!</p>
            <a href="{% url 'main:show_main' %}" class="mt-4 inline-block px-6 py-3 bg-[#0050a0] text-white rounded-lg font-medium hover:bg-[#f0b414] hover:text-[#000000] transition">Back to Product List</a>
          </div>

          <form id="create-product-form" method="POST" class="px-6 sm:px-8 py-6 space-y-6">
            {% csrf_token %}

            {% for field in form %}
              <div>
                <label for="{{ field.id_for_label }}" class="block text-sm font-medium text-[#000000] mb-2">
                  {{ field.label }}
                </label>
                <div class="w-full [&>input]:w-full [&>textarea]:w-full [&>select]:w-full
                            [&>input]:px-4 [&>textarea]:px-4 [&>select]:px-4
                            [&>input]:py-3 [&>textarea]:py-3 [&>select]:py-3
                            [&>input]:border [&>textarea]:border [&>select]:border
                            [&>input]:border-[#000000] [&>textarea]:border-[#000000] [&>select]:border-[#000000]
                            [&>input]:rounded-lg [&>textarea]:rounded-lg [&>select]:rounded-lg
                            [&>input]:focus:outline-none [&>textarea]:focus:outline-none [&>select]:focus:outline-none
                            [&>input]:focus:border-[#0050a0] [&>textarea]:focus:border-[#0050a0] [&>select]:focus:border-[#0050a0]
                            [&>input]:focus:ring-4 [&>textarea]:focus:ring-4 [&>select]:focus:ring-4
                            [&>input]:focus:ring-[#0050a0]/20 [&>textarea]:focus:ring-[#0050a0]/20 [&>select]:focus:ring-[#0050a0]/20">
                  {{ field }}
                </div>
                {% if field.help_text %}
                  <p class="mt-2 text-xs text-[#f0b414]">{{ field.help_text }}</p>
                {% endif %}
                {% for error in field.errors %}
                  <p class="mt-2 text-xs text-[#f03c50]">{{ error }}</p>
                {% endfor %}
              </div>
            {% endfor %}

            <div class="flex flex-col sm:flex-row gap-3 pt-6 border-t border-[#000000]/10">
              <a href="{% url 'main:show_main' %}"
                 class="order-2 sm:order-1 px-6 py-3 border border-[#000000] text-[#000000] rounded-lg font-medium
                        hover:bg-[#f0b414] hover:text-[#000000] transition-colors text-center">
                Cancel
              </a>
              <button type="submit"
                      class="order-1 sm:order-2 flex-1 bg-[#0050a0] text-white px-6 py-3 rounded-lg font-medium
                             hover:bg-[#f0b414] hover:text-[#000000] hover:shadow-xl hover:ring-4 hover:ring-[#0050a0]/30
                             transform hover:scale-[1.01] transition">
                Publish Product
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- RIGHT: SIDE PANEL (tips saja) -->
      <aside class="space-y-6">
        <!-- Tips card -->
        <div class="bg-white/10 backdrop-blur-sm rounded-2xl border border-white/20 p-6 text-white min-h-[250px]">
          <h2 class="text-lg font-semibold mb-2">Tips</h2>
          <ul class="list-disc list-inside text-sm text-white/90 space-y-1">
            <li>Gunakan nama product yang menarik.</li>
            <li>Tambahkan deskripsi yang menjelaskan produk.</li>
            <li>Gunakan gambar yang jernih dan jelas.</li>
          </ul>
        </div>
      </aside>
    </div>
  </div>
</div>

<script>
const form = document.getElementById('create-product-form');
const loadingDiv = document.getElementById('ajax-loading');
const errorDiv = document.getElementById('ajax-error');
const successDiv = document.getElementById('ajax-success');

// Show/hide AJAX states
function showAjaxState(state) {
    loadingDiv.classList.toggle('hidden', state !== 'loading');
    errorDiv.classList.toggle('hidden', state !== 'error');
    successDiv.classList.toggle('hidden', state !== 'success');
    form.classList.toggle('hidden', state !== 'form');
}

// Initial state
showAjaxState('form');

form.addEventListener('submit', async function(e) {
    e.preventDefault();
    showAjaxState('loading');

    const formData = new FormData(form);

    try {
        const response = await fetch("{% url 'main:create_product' %}", {
            method: "POST",
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
            },
            body: formData,
        });

        if (!response.ok) {
            throw new Error('Failed to create product');
        }

        const data = await response.json();
        showAjaxState('success');
    } catch (err) {
        showAjaxState('error');
    }
});
</script>
{% endblock content %}
